<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Auth Website</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.7.7/axios.min.js"></script>
  </head>
  <body>
    <div>
      <span>Signup</span>
      <input
        type="text"
        name="Username"
        id="signup-username"
        placeholder="Username"
      />
      <input
        type="text"
        name="password"
        id="signup-password"
        placeholder="Password"
      />
      <button onclick="signup()">Submit</button>
    </div>
    <div>
      <span>Signin</span>
      <input
        type="text"
        name="Username"
        id="signin-username"
        placeholder="Username"
      />
      <input
        type="text"
        name="password"
        id="signin-password"
        placeholder="Password"
      />
      <button onclick="signin()">Submit</button>
    </div>

    <div>
      <span>User Information</span>
      <div id="Information"></div>
    </div>

    <div>
      <button onclick="logout()">Logout</button>
    </div>
  </body>
  <script>
   async function signup() {
    const username = document.getElementById("signup-username").value;
    const password = document.getElementById("signup-password").value;

    try{
    const response =   await axios.post("http://localhost:3000/signup",{
      username,
      password,
    })

    alert(response.data.message)
   }catch(error){
    console.error("Error while signing up: "+ error);
   }
    }

   async function signin() {
    const username  = document.getElementById("signin-username").value;
    const password = document.getElementById("signin-password").value;

    try{
      const response = await axios.post("http://localhost:3000/signin",{
        username,
        password,
      });

      if(response.data.token){
        localStorage.setItem("token", response.data.token);
        alert(response.data.message);

        getUserInfo();
      }else{
        alert(response.data.message)
      }
    }catch(error){
      console.log(`error while signing in :  ${error}`)
    }
   }
    async function getUserInfo(){
        try{
            const response = await axios.get("http://localhost:3000/me",{
                headers : {
                    token : localStorage.getItem("token")
                }
            })

            const infoDiv = document.getElementById("Information");

            if(response.data.username){
                infoDiv.innerText = `Username : ${response.data.username} and password : ${response.data.password}`;

            }else{
                infoDiv.innerText = response.data.message;
            }
        }catch(error){
            console.log(`Error while fetching user information: ${error}`)
        }
    }

     function logout() {
                // Remove the authentication token from local storage
                localStorage.removeItem("token");

                // Alert the user that they have logged out
                alert("You have logged out!");
                
                // Clear the user information displayed on the page
                document.getElementById("Information").innerText = "";
            }
  </script>
</html>
